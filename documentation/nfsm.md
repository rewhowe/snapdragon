# Non-Deterministic Finite State Diagrams / 非決定性有限状態図

The diagrams below describe the different sequences supported by 金魚草's grammar. Each sequence is shown as an flowchart auto-generated by [mermaid](https://mermaid-js.github.io/mermaid/#/), and as a sort of pseudo-regex format.

## ASSIGNMENT

![assignment](./nfsm/assignment.png)

```
BOL
POSSESSIVE ?
ASSIGNMENT
( RVALUE | ( POSSESSIVE PROPERTY ) )
QUESTION ?
( COMMA ( RVALUE | ( POSSESSIVE PROPERTY ) ) QUESTION ? ) *
EOL
```

```mermaid
graph LR
  BOL --> POSSESSIVE_1[POSSESSIVE]
  POSSESSIVE_1[POSSESSIVE] --> ASSIGNMENT

  ASSIGNMENT --> RVALUE
  ASSIGNMENT --> POSSESSIVE_2[POSSESSIVE]

  RVALUE --> EOL
  RVALUE --> QUESTION
  RVALUE --> COMMA

  POSSESSIVE_2[POSSESSIVE] --> PROPERTY

  PROPERTY --> EOL
  PROPERTY --> QUESTION
  PROPERTY --> COMMA

  COMMA --> RVALUE
  COMMA --> POSSESSIVE_2[POSSESSIVE]

  QUESTION --> COMMA
  QUESTION --> EOL
```

## FUNCTION\_DEF / FUNCTION\_CALL

![function-def](./nfsm/function-def.png)

`BOL PARAMETER * FUNCTION_DEF BANG ? EOL`

```mermaid
graph LR
  BOL --> PARAMETER
  BOL --> FUNCTION_DEF

  PARAMETER --> PARAMETER
  PARAMETER --> FUNCTION_DEF

  FUNCTION_DEF --> EOL
  FUNCTION_DEF --> BANG

  BANG --> EOL
```

![function-call](./nfsm/function-call.png)

`BOL ( POSSESSIVE ? PARAMETER ) * FUNCTION_CALL BANG ? QUESTION ? EOL`

```mermaid
graph LR
  BOL --> PARAMETER
  BOL --> FUNCTION_CALL
  BOL --> POSSESSIVE

  PARAMETER --> PARAMETER
  PARAMETER --> FUNCTION_CALL

  FUNCTION_CALL --> EOL
  FUNCTION_CALL --> BANG
  FUNCTION_CALL --> QUESTION

  POSSESSIVE --> PARAMETER

  BANG --> QUESTION

  QUESTION --> EOL
```

## RETURN

![return](./nfsm/return.png)

`BOL ( POSSESSIVE ? PARAMETER ) ? RETURN EOL`

```mermaid
graph LR
  BOL --> PARAMETER
  BOL --> POSSESSIVE
  BOL --> RETURN

  PARAMETER --> RETURN

  POSSESSIVE --> PARAMETER

  RETURN --> EOL
```

## LOOP / LOOP\_ITERATOR / NEXT / BREAK

![loop](./nfsm/loop.png)

`BOL ( PARAMETER ( PARAMETER | LOOP_ITERATOR ) ) ? LOOP EOL`

```mermaid
graph LR
  BOL --> PARAMETER_1[PARAMETER]
  BOL --> POSSESSIVE_1[POSSESSIVE]
  BOL --> LOOP

  PARAMETER_1[PARAMETER] --> PARAMETER_2[PARAMETER]
  PARAMETER_1[PARAMETER] --> LOOP_ITERATOR
  PARAMETER_1[PARAMETER] --> POSSESSIVE_2[PARAMETER]

  PARAMETER_2[PARAMETER] --> LOOP

  POSSESSIVE_1[POSSESSIVE] --> PARAMETER_1[PARAMETER]

  POSSESSIVE_2[POSSESSIVE] --> PARAMETER_2[PARAMETER]

  LOOP_ITERATOR --> LOOP

  LOOP --> EOL
```

![next](./nfsm/next.png)

```mermaid
graph LR
  BOL --> NEXT

  NEXT --> EOL
```

![break](./nfsm/break.png)

```mermaid
graph LR
  BOL --> BREAK

  BREAK --> EOL
```

## IF / ELSE\_IF / ELSE

![if-comparison](./nfsm/if-comparison.png)

```rb
BOL
( IF | ELSE_IF )
POSSESSIVE ?
(
  COMP_1 QUESTION ( COMP_2 | COMP_2_NOT )
  | SUBJECT POSSESSIVE ? (
    ( COMP_1 | COMP_1_GTEQ | COMP_1_LTEQ | COMP_1_EMP ) ( COMP_2 | COMP_2_NOT )
    | COMP_1_TO ( COMP_2_EQ | COMP_2_NEQ)
    | COMP_1_YORI ( COMP_2_LT | COMP_2_GT )
  )
)
EOL
```

```mermaid
graph LR
  BOL --> IF[IF / ELSE_IF]

  IF[IF / ELSE_IF] --> SUBJECT
  IF[IF / ELSE_IF] --> COMP_BOOL_BEGIN
  IF[IF / ELSE_IF] --> POSSESSIVE_BOOL[POSSESSIVE]
  IF[IF / ELSE_IF] --> POSSESSIVE_1[POSSESSIVE]

  SUBJECT --> COMP_1
  SUBJECT --> COMP_1_TO
  SUBJECT --> COMP_1_YORI
  SUBJECT --> COMP_1_GTEQ
  SUBJECT --> COMP_1_LTEQ
  SUBJECT --> POSSESSIVE_2[POSSESSIVE]
  SUBJECT --> COMP_1_EMP

  POSSESSIVE_BOOL[POSSESSIVE] --> COMP_BOOL_BEGIN[COMP_1]
  COMP_BOOL_BEGIN[COMP_1] --> QUESTION

  QUESTION --> COMP_BOOL_CLOSE[COMP_2]
  QUESTION --> COMP_BOOL_CLOSE_NOT[COMP_2_NOT]

  COMP_BOOL_CLOSE[COMP_2] --> EOL
  COMP_BOOL_CLOSE_NOT[COMP_2_NOT] --> EOL

  COMP_1 --> COMP_2
  COMP_1 --> COMP_2_NOT

  COMP_1_GTEQ --> COMP_2
  COMP_1_GTEQ --> COMP_2_NOT

  COMP_1_LTEQ --> COMP_2
  COMP_1_LTEQ --> COMP_2_NOT

  COMP_1_TO --> COMP_2_EQ
  COMP_1_TO --> COMP_2_NEQ

  COMP_1_YORI --> COMP_2_LT
  COMP_1_YORI --> COMP_2_GT

  COMP_1_EMP --> COMP_2
  COMP_1_EMP --> COMP_2_NOT

  COMP_2_EQ --> EOL

  COMP_2_NEQ --> EOL

  COMP_2 --> EOL

  COMP_2_NOT --> EOL

  subgraph subject
    POSSESSIVE_1[POSSESSIVE] --> SUBJECT
  end

  subgraph comparison begin
    POSSESSIVE_2[POSSESSIVE] --> COMP_1
    POSSESSIVE_2[POSSESSIVE] --> COMP_1_TO
    POSSESSIVE_2[POSSESSIVE] --> COMP_1_YORI
    POSSESSIVE_2[POSSESSIVE] --> COMP_1_GTEQ
    POSSESSIVE_2[POSSESSIVE] --> COMP_1_LTEQ
    COMP_1_EMP
  end

  subgraph comparison close
    COMP_2

    COMP_2_NOT

    COMP_2_LT

    COMP_2_GT

    COMP_2_EQ

    COMP_2_NEQ
  end
```

![if-function-call](./nfsm/if-function-call.png)

`BOL ( IF | ELSE_IF ) ( POSSESSIVE ? PARAMETER ) * FUNCTION_CALL BANG ? QUESTION ( COMP_2 | COMP_2_NOT ) EOL`

```mermaid
graph LR
  BOL --> IF[IF / ELSE_IF]

  IF[IF / ELSE_IF ] --> POSSESSIVE
  IF[IF / ELSE_IF ] --> PARAMETER
  IF[IF / ELSE_IF ] --> FUNCTION_CALL

  subgraph subject
    PARAMETER --> POSSESSIVE
    PARAMETER --> PARAMETER
    PARAMETER --> FUNCTION_CALL

    POSSESSIVE --> PARAMETER
  end

  FUNCTION_CALL --> QUESTION

  QUESTION --> COMP_2
  QUESTION --> COMP_2_NOT

  COMP_2 --> EOL

  COMP_2_NOT --> EOL

  subgraph comparison open
    QUESTION
  end

  subgraph comparison close
    COMP_2
    COMP_2_NOT
  end
```

![else](./nfsm/else.png)

```mermaid
graph LR
  BOL --> ELSE

  ELSE --> EOL
```

## MISC

![no-op](./nfsm/no-op.png)

```mermaid
graph LR
  BOL --> NO_OP

  NO_OP --> EOL
```

![debug](./nfsm/debug.png)

```mermaid
graph LR
  BOL --> DEBUG

  DEBUG --> BANG
  DEBUG --> EOL

  BANG --> EOL
```
